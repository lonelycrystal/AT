ОТКЛЮЧАЙТЕ БРЕНД МАУЭР НА ВСЕХ ВЕРТУАЛЬНЫХ МАШИНАХ. ИЗ ЗА НЕГО НИЧЕГО РАБОТАТЬ НЕ БУДЕТ
ЧТОБЫ ОТКЛЮЧИТЬ, НЕОБХОДИМО НА ВСЕ МАШИНЫ, КОТОРЫЕ БУДУТ СОЗДАВАТЬСЯ, В БРАНДМАУЭР ДОБАВЛЯЕМ ПРАВИЛА НА ВХОДНЫЕ И ВЫХОДНЫЕ ПОДКЛЮЧЕНИЯ

Модуль 1
Установка IWTM 
Настройка VM oracle:
Выставляем 8гб оперативной памяти
2ядра ЦП
Не менее 100гб ЖД
Сеть:  сетевой мост
Далее выбираем образ ks-6.10.0.402-TM
 
Выбираем версию ТМ Enterprise


Далее выбираем DB-PostgreSQL
 

Выбираем пункт TME All in one

 
В появившимся окне выбираем Yes, discard any data 
Выбираем регион Москва или Барнаул и ставим галочку System clock uses UTC 
Вводим пароль root пользователя xxXX1234 (Или тот который дан по заданию)
 
Выбираем Use anyway 
Далее выбираем Use all space и ставим галочку review and modify partitioning layout
 

Выбираем Iv_home  и удаляем 
 
Далее выбираем Iv_ root  и жмем кнопку edit, затем в графу size вписываем число которое указано ниже в строчке (Max size is ваше число) и жмем ОК, затем некст и выбираем Format
 

До появления этого окна больше ничего не трогаем. 
Заходим в Device configuration 
Выбираем устройство
 
В строке Use DHCP вместо * ставим пробел и далее настройки Gateway и DNS вводим сервера, а Static IP тот который у вас указан, на самом конкурсе они будут указаны. Жмем Ок и Save

 
Далее выбираем DNS configuration 
 
Вводим такие данные. Далее жмем ОК , Save and quit

 
После этого появится такая строчка пишем y
 
После этого везде жмем ок и save и accept 


Вводим логин root
 
Вводим пароль xxXX1234(ЕГО НЕ ВИДНО!!!)
 
System-config-network команда для смены сетевых настроек
Активация краулера(crawler)
Вводи команду cd /opt/iw/tm5/etc  
mcedit web.conf
 
В графе crawler enabled меняем значение с 0 на 1 и жмем f2 и f10
После этого вводи service iwtm restart kicker


После этого открываем браузер 
И вводим  
После ввода выдаст ошибку о небезопасности подключения, в нижнем правом угле нажать дополнительно и найти все равно перейти на сайт
 
Вводим логин officer  а пароль xxXX1234
 Далее выбираем управление-лицензии 


Выбираем создать если есть прошлая удалить
 
Далее заходим в управление-LDAP синхронизация, жмем создать 
Вводим данные со скриншота(на конкурсе будут данные даны)

 
Заходить нужно под доменным пользователем Administrator


Установка базы данных Запускаем IWDB(устанавливаем виртуалку и называем IWDB)
Ставим внутреннюю сеть и вводим сетевые настройки адаптера
 
Вводим в домен пк 
Заходим в Панель управления\Система и безопасность\Система
 
Жмем изменить параметры
 
Нажимаем изменить
 
Выбираем домена и вводим demo.lab
 
Вводим логим Administrator пароль xxXX1234, перезагружаем виртуалку
 
Жмем сменить пользователя  
Выбираем другой пользователь  и вводим логин и пароль администратора домена(Administrator xxXX1234)
Устанавливаем  postgresql-9.6.9-1-windows-x64 
 

Везде жмем продолжить до этого момента(Внимание тут написан логин пользователя в скобках, запомните его или запишите)
Вводим пароль xxXX1234
 
Дальше все опять жмем далее
Затем, после установки, заходим в папку по этому пути  C:\Program Files\PostgreSQL\9.6\data находим там файл pg_hba.conf и открываем его с помощью блокнота
Пролистываем в самый низ файл и вписываем туда ip компьютера, куда будет установлен краулер и / 32
1 фото –до изменения
2 фото – после
 

IWDM
Ставим внутреннюю сеть
Тоже вносим в домен
Устонавливаем Setup.DeviceMonitor.ru.x64.6.10.0.255
Запускаем и жмем далее  
Выбрать основной сервер и убрать галочку опубликовать сервер в Active directory
 
Выбираем PostgreSQL
 
Вносим данные 
1 ip того куда вы устанавливали БД
2 имя любое
3 логин который был указан  в установке (postgres)
4 пароль который вводили при установке БД(xxXX1234)
 
Жмем далее
 
Ничего не пишем и жмем далее
 

Имя пользователя officer пароль xxXX1234
 
Первое, адрес сервера IWTM(red hat)
Токен ищем в iwtm
 
Заходим в управление-плагины-токены и переписываем его в DM 
 
Вводим ip того куда устоновлена БД логин и пароль который писали раньше
 
Заходим  в инструменты- интеграция с AD
 
Создаем правило на компьютеры и на пользователей
 
Выбираем группы DM или вводим ip нужного компа дальше везде жмем далее, если распространение не работаем создаем пакет вручную
 

Выбираем там папку и везде жмем далее
Краулер
Устанавливаем Crawler 6.10.0.238


Выбираем PostgreSQL Вводим в первой строке ip IWTM, другой не трогаем и вводим пароль xxXX1234 затем жмем далее
В нижней строке необходимо написать ключ Consul
По стандарту он выгляди так: 4RTZ5ttYY6RwIYX28XWNPw==

(чтобы сменить его, необходимо в IWTM прописать команду consul keygen)
 
После этого, везде жмем далее
После установки в IWTM переходим в каталог cd /etc
Затем вводим команду mcedit hosts
В появившемся окне вводим айпи машина на которую установлен краулер и имя компьютера 2 раза ( его смотреть в гугле введя в поисковик 127.0.0.1:8500 )
 
После этого Краулер должен заработать. Если после перезагрузки пк краулер не запустился, то нужно его включить в службах.
Заходим в пуск---панель управления. Значки ставим мелкие
 
Затем заходим в Администрирование---службы

 
Если краулер выключен, то включаем его


Добавляем задачу в веб интерфейсе TM 

 
В наименовании пишем любое и жмем далее

 
Нажимаем кнопку добавить и вводим ip интрудера (192.168.0.5) и жмем далее
Затем везде жмем далее ничего не меняя
После этого, задача выдаст ошибку. Нужно выполнить ее еще раз но от имени администратора. Запускаем задачу еще раз.
В графе пользователь вводим demo/Administrator (если не работает, то просто Administrator)
В графе пароль вводим xxXX1234
После этого зада должна запуститься и потребуется перезагрузить интрудера
 

МОДУЛЬ 2
Задание 1
Создайте локальную группу пользователей «Подозрительные» в Traffic Monitor. Добавьте в нее «нарушителей» (пользователей домена для хостовой и виртуальной машины с установленным агентом).
Подтвердите выполнение задания скриншотами.
 
  Задание 2
Для дальнейшей работы системы необходимо настроить периметр компании:
•	Почтовый домен: demo.lab
•	Список веб ресурсов: worldskills.moscow, dlptest.com,dlp.demo.lab.worldskills.ru.
•	Группа персон 1 : пользователи домена.
•	Группа персон 2: группа «подозрительные».
•	Исключить из перехвата почту генерального директора.
Подтвердить выполнение задания скриншотами.

 
Переходим в веб ресурсы и создаем список для задания
 
Переходим в периметры
Настраеваем периметр компании 
 
Исключаем из перехвата почту ген директора

Задание 3
Необходимо создать пользователя системы с правами доступа только на чтение, выполнение отчетов, сводок и событий без возможности редактирования.
Логин: userevents, пароль:XxXx!4321
 
Нажимаем + и создаем пользователя 


Создаем роль 
 
Задаем роль 
 

Перед  работой с политиками удалите все стандартные политики или отключите
Не забывайте сохранять и применять каждое действие
Политика 1
Реализуйте политику, исключающую из перехвата генерального директора.
Разрешить передачу, уровень угрозы – отсутствует.
  

Политика 2
В связи с подозрительной активностью необходимо ввести под наблюдение пользователей отдела договоров.
 
Создаем группу пользователей(на конкурсе будет создана сразу  с подключение LDAP)
Добавляем политику контроля персон 
 и в ней ставим группу отдела договоров  и добавляем  правило контроля
 

Если написано за пределы компании значит получатели все кроме периметра компании, а если внутри компании то отправитель и получать периметр компании
Каждое действие и политику нужно сохранять и применять
 
Для того что бы работали политики в Device monitor’e нужно настроить политику и применить ее к той группе компов, с которых будет происходить проверка политик 
Так же в DM нужно сохранять и применять все политики и действия
Политика 3
В связи с постоянными проблемами при организации очередного чемпионата WorldSkills (Региональный Чемпионат), совет директоров решил контролировать передачу информации о WorldSkills и Региональном Чемпионате за пределы компании. В связи с этим необходимо создать политику в IWTM на правило передачи текстовых данных за пределы компании (на адрес вне домена), содержащих слова «ВорлдСкилз», «WorldSkills». Необходимо учесть, что в словах могут содержаться комбинации латиницы и кириллицы, а также стоять пробелы между словами. Ложных срабатываний быть не должно.

Для задания нужны регулярные выражения 
 
Технологии-текстовые объекты 
Там создаем новый каталог и в нем файл 
В файле настраиваем регулярку 
 
Создаем объект и добавляем к нему созданные текстовый объект
([W-w]orld|[В-в]орлд)\s{0,}([S-s]kills|[С-с]киллз) (укороченная версия)

 
Создаем тег (Списки-теги)
 
Настраиваем политику

Политика 4
Всему персоналу кроме сотрудников и руководителей отдела кадров запрещено отправлять данные СНИЛС и ИНН, а так же паспортные данные РФ в любом виде (текст, сканы, фото) за пределы компании.
 
Нажимаем создать и выбираем нужные данные в текстовых объектах
 
Настраиваем объект на встречаемость


Создаем политику называем и добавляем объект, далее ставим правило передачи и настраиваем его
 
Настроенная политика
Политика 5
Компания выпускает новый продукт и хочет пресечь любые утечки со стороны сотрудников. Необходимо блокировать передачу с упоминанием «Новый продукт», «новейшая разработка» и «новинка!» за пределы компании. При этом исполнительный директор может обмениваться данной информацией совершенно свободно.
Уровень угрозы – высокий, не блокировать передачу внутри компании, тег – «Политика 5».
Создаем каталог текстовых объектов и в нем создаем объект назыаем по заданию, далее 
Вот так выглядит регулярное выражени \s это знак пробела  
Создаем объект защиты, и настраиваем политику и тег
Политика 6
Необходимо вести наблюдение за передачей документов с печатью компании за пределы компании, при этом запрещая любую внешнюю передачу документов, содержащих печать компании в пустых и заполненных бланках «анкета участника.docx», при этом бланки без печати контролировать не нужно.
Печать: уровень угрозы – низкий, не блокировать, тег «печать».
Печать + бланк: уровень угрозы – средний, блокировать, тег «политика 6».
Заходим в технологии-печати
 
Создаем и загружаем печать, далее в папке WorldSkills\InfoWatch\Additional Files анкета участника загружаем печать, теперь заходим в технологии-бланки создаем бланк и загружаем нашу проштампованную анкету. Создаем объект защиты с печатью, в этом же каталоге создаем еще один объект на бланк и в нем выбираем в условии обнаружения  
Так же создаем 2 политики одна на печать, вторая на бланк с печатью
Политика 7
В последнее время возникла необходимость обработки текстовых данных, а так же сканов и фото кредитных карт. Необходимо отслеживать передачу всех возможных данных кредитных карт (в том числе сканов) за пределы компании.
Блокировать, уровень угрозы – высокий, тег «Политика 7».
Создаем объект защиты в нем,  в каталоге текстовых объектах выбираем номер кредиткой карты, в графических объектах тоже выбираем кредитная карта
Условия обнаружения 
 
Далее создаем политику и тег 
Политика 8
В связи с постоянными заказами на транспортировку больших грузов, сотрудники компании подрабатывают в тайне от начальства, занимаясь попутной перевозкой других грузов, а так же пассажиров. В связи с этим необходимо отслеживать в почтовых сообщениях упоминания об автостопе, халтуре, подработке, грузовом такси. Стоит учесть морфологию и различные варианты написания ключевых слов.
Заходим в технологии-категории и термины 
Создаем категорию и в ней список терминов 
 
Так же прописываем эти термины в регулярной политике в текстовых объектах
Далее настраиваем  объекты защиты, создаем и настраиваем политику безопасности и тег 


Политика 9
Для контроля за движением официальных документов необходимо вести наблюдение за передачей как пустых, так и заполненных шаблонов документа (шаблон – «договор компании.doc») за пределы компании. Стоит учесть, что содержимое документа может изменяться в пределах 25%.
Уровень угрозы – низкий, не блокировать, тег «политика 9».
Заходим в технологии-эталонные документы
Создаем там эталон
 
В пределах 25% это значит что 75% должно оставаться неизменным 
Загружаем документ(Документ компании.doc)
Далее создаем объект защиты, создаем политику и тег
Политика 10
Необходимо контролировать циркуляцию внутри организации документов с грифом «совершенно Секретно», а также блокировать их прием и передачу за пределы компании.
Уровень угрозы – высокий, блокировать передачу на внешние ресурсы, не блокировать передачу внутри компании, тег «политика 10».
Создаем объект и добавляем туда категорию гостайна
Далее создаем 2 политики одну на контроль внутри компании(не блокировать)
Вторую на отправление документов за пределы компании
Создаем тег
Политика 11
При разработке генератора трафика для IWTM были замечены случаи утечки частей коды третьим лицам. Код генератора разрабатывается на Pyton 2.7 для поддержки legacy-систем, а также имеет небольшой модуль на С. В связи с этим необходимо предотвращать любые утечки кода за пределы компании кроме совета директоров.
Уровень угрозы высокий, тек «политика 11»
Добавляем оба документа в эталоны, и в эталонные документы и ставим что их нельзя изменять(100%) далее создаем объект и создаем и настраиваем политику и делаем тег 
Политика 12
Необходимо настроить передачу документов с грифом (информационной меткой) «ООО Demo Lab. Конфиденциально» или «ООО Demo Lab. Строго Конфиденциально» любым сотрудникам за пределы компании. Обратите внимание, что при вводе информационной метки с клавиатуры сотрудники могут ошибаться и вводить между словами более 1 пробела или табуляции, а также писать название компании на русском языке, например, «ООО Demo Лаб», «ООО Демо Лаб».
Создаем текстовый объект и в нем настраиваем регулярное выражение
 
После этого создаем объект защиты, создаем  и настраиваем политику и ставим тег
([O-o|О-о]{3}\s{0,}([D-d]emo|[Д-д]емо)\s{0,}([L-l]ab.|[Л-л]аб.)\s{0,}([С-с]трого\s{0,}[К-к]онфиденциально|[К-к]онфиденциально)) (правильная версия)
Политика 13
В компании было замечено, что сотрудники стали получать множество рекламных сообщений по электронной почте, из-за чего возникла необходимость отследить потенциальную утечку баз email адресов сотрудников. В связи с этим необходимо детектировать сообщения. Содержащие адреса электронной почты. Стоит учесть, что в связи с импортозамещением данные адреса могут находиться и на кириллических доменах, а также содержаться другие допустимые символы email адресов. Детектирование только частей адресов (например, @mail.ru) недопустимо. Пример формата адресов: eHYPERLINK "mailto:e-mail@altai.com"-HYPERLINK "mailto:e-mail@altai.com"mailHYPERLINK "mailto:e-mail@altai.com"@HYPERLINK "mailto:e-mail@altai.com"altaiHYPERLINK "mailto:e-mail@altai.com".HYPERLINK "mailto:e-mail@altai.com"com, mailHYPERLINK "mailto:mail+alt@mail.com"+HYPERLINK "mailto:mail+alt@mail.com"altHYPERLINK "mailto:mail+alt@mail.com"@HYPERLINK "mailto:mail+alt@mail.com"mailHYPERLINK "mailto:mail+alt@mail.com".HYPERLINK "mailto:mail+alt@mail.com"com, элепочта»колледж.рф.
Уровень угрозы средний, тег «политика 13»
Создаем текстовый объект с регулярными выражаниями
 
((\w|\W|\d)+@(\w|\W|\d.)+(\w){2,6}) (укороченная версия)
(^[-|!|.|:|a-z|A-Z|а-я|А-Я|0-9|_|!|-|.]+@[a-zA-Z|а-яА-Я]{2,}\.[a-zA-Z|а-яА-Я]{2,4}$) (если первая версия не заработает)
 
Далее создаем объект защиты, создаем и настраиваем политику и тег
Политика 14
Необходимо настроить мониторинг выгрузок из БД для контроля движения данных из базы данных страховых компаний. Критичными данными в выгрузке являются телефоны, ИНН, ОКПО, ОКФС, ОКОГУ и ОКОПФ и в 1 документе присутствует более 3 компании. Для настройки используйте файл stock_members_details_catch.cvs.
Уровень угрозы низкий, не блокировать, тег «политика 14».
Проверить работоспособность  с помощью попытки передачи части выгрузки на 2 строки и на более 3 строк и и подтвердить скриншотом.
Заходим в технолигии-выгрузки из БД 
 
Создаем выгрузку и загружаем туда файл stock_members_details_catch.cvs
После загрузки жмем редактивровать, удаляем стандартное правило, создаем новое 
 
Далее создаем объект защиты и создаем политику и тег
Политика 15
Радиоэлектронное оборудование, разрабатываемое и поставляемое компанией для вооруженных сил, планируется к установке на определенных военно-технических объектах. Информация о технике может иметь конфиденциальный и секретный характер, хотя и не содержать гриф. Необходимо блокировать любые попытки передачи данных об этих объектах на внешние адреса. Технические объекты задаются буквенно-цифровыми кодами на русском языке: 
«3 цифры – буква – цифра – 2 буквы» или «1 цифра – две буквы – цифра – 2 буквы».
Пример: 343Б5ыА, 4ка9Уа
Необходимо отслеживать передачу, копирование, хранение и буфер обмена.
Проверить работоспособность 2-3 примеров самостоятельно с занесением событий в систему. 
Уровень угрозы высокий, блокировать, тег «РЭУ».
Проверить работоспособность 2-3 примеров аббревиатур самостоятельно с занесением событий в систему. 
 
Создаем регулярное выражение в текстовых объектов 

Далее создаем объект защиты и политику на все типы , так же тег

Политика 16
Необходимо предотвратить передачу любых стандартизированных паролей в открытом виде любыми отправителями и получателями.
Стандартизированные форматы паролей (кириллица):
•	6 букв – 2 цифры – 3 буквы – 2 знака ? или ! (например, ПаРолЬ67рКЕ!? )
•	4 цифры – 1 знак ! или ? – 6 букв – 2 цифры (например, 3429!СекРет88 )
Проверить работоспособность 1-2 примеров самостоятельно с занесением событий в систему. Необходимо отслеживать передачу, копирование, хранение и буфер обмена.
Уровень угрозы средний, блокировать.
([А-Я|а-я]{6}\d{2}\w{3}\W{1,2})|(\d{4}\W{1}[А-Я|а-я]{6}\d{2})
Так же создаем регулярное выражение подобно предыдущему заданию, где воскл занак пишем [:print:] и вместо принт знак , далее создаем объект защиты и создаем политику и тег
Политика 17
Необходимо поставить на мониторинг все зашифрованные и запорошённые данные т.к. попытки передачи таких данных несут потенциальную опасность утечки.
Уровень угрозы – низкий, не блокировать, тег «Политика 17».
Cоздаем политику, там где нужно выбрать защищаемые данные, выбираем файловые форматы и ставим галочку зашифрованные, и выделяем все типы
Сохраняем, настраиваем политику и создаем по аналогии вторую на запароленные 

Модуль 4 Технологии агентского мониторинга
Политика 4
Необходимо запретить пользоваться Microsoft Paint, а так же Paint 3D (При наличии), так как участились случаи подделки печатей компании.
Заходим в прилодения, создаем там новый список и называем его правильно, и в списке пишем название приложения которое необходимо заблокировать, правильное имя приложения смотриться в диспетчере задач как на пример паинт
 

Далее создаем политику на мониторинг приложений ставим галку запрет запуска, добавляем туда ранее созданный список и нажимаем сохранить, сохраняем действия и применяем к компам
 
На клиенте с установленным клиентским DM, запрашиваем обновление правил
 
 
Политика сработала
Доп.информация

Отборочные глав.сервер (на нем настроен домен и АД)
ip 192.168.0.1
домен demo.lab
Administrator
xxXX1234
имя компьютера central

Отборочные IWTM
IP 192.168.0.2
пользователь root
пароль xxXX1234

отборочные сервер базы данных
ip 192.168.0.3
локальный пользователь: Администратор
пароль P@ssword5
изменить имя компьютера на winBD
Ввести в домен Demо.lab 
пользователь IWDB
пароль 4815162342Bd

Отборочные сервер win
ip 192.168.0.4
локальный пользователь: Администратор
пароль P@ssword5
изменить имя компьютера на winDM
Ввести в домен Demо.lab 
пользователь WSR02
пароль xxXX1234

Отборочные нарушитель
ip 192.168.0.5
локальный пользователь: user
пароль P@ssword5
изменить имя компьютера на Intruder
Пользователь IntruderWSR01 
Пароль 4321XXxx




































ЗАРЭЖЬТЕ БАРАНА
